@page "/collegati"
@inject NavigationManager Navigation

<PageTitle>Collegamento</PageTitle>

<h1>Seleziona il numero di KW</h1>

<div class="form-group">
    <label for="kwDropdown">Seleziona KW:</label>
    <select class="form-control" id="kwDropdown" @onchange="OnKWSelectionChanged">
        <option value="custom">Seleziona manualmente...</option>
        <option value="5">5 KW</option>
        <option value="10">10 KW</option>
        <option value="20">20 KW</option>
        <option value="30">30 KW</option>
        <option value="40">40 KW</option>
        <option value="50">50 KW</option>
    </select>
</div>

@if (showCustomKW)
{
    <div class="form-group">
        <label for="customKW">Inserisci KW manualmente:</label>
        <input type="number" class="form-control" id="customKW" @bind="selectedCustomKW" />
    </div>
}

<h1>Seleziona la colonnina</h1>

<div class="map">
    <div class="column-container">
        <div class="column" @onclick="() => SelectColumn(1)" :class="columnSelected == 1 ? 'selected' : ''">Colonnina 1</div>
        <div class="column" @onclick="() => SelectColumn(2)" :class="columnSelected == 2 ? 'selected' : ''">Colonnina 2</div>
        <div class="column" @onclick="() => SelectColumn(3)" :class="columnSelected == 3 ? 'selected' : ''">Colonnina 3</div>
        <div class="column" @onclick="() => SelectColumn(4)" :class="columnSelected == 4 ? 'selected' : ''">Colonnina 4</div>
        <div class="column" @onclick="() => SelectColumn(5)" :class="columnSelected == 5 ? 'selected' : ''">Colonnina 5</div>
    </div>
</div>

<button class="btn btn-primary" @onclick="NavigateToRifornimento">Seleziona</button>

@code {
    private bool showCustomKW = false;
    private int selectedCustomKW = 0;
    private int columnSelected = 0;

    private void OnKWSelectionChanged(ChangeEventArgs e)
    {
        var selectedValue = e.Value?.ToString();
        if (selectedValue == "custom")
        {
            showCustomKW = true;
        }
        else
        {
            showCustomKW = false;
            if (int.TryParse(selectedValue, out int kw))
            {
                selectedCustomKW = kw;
            }
        }
    }

    private void SelectColumn(int columnNumber)
    {
        columnSelected = columnNumber;
    }

    private void NavigateToRifornimento()
    {
        if (columnSelected > 0 && (selectedCustomKW > 0 || selectedCustomKW == 0 && !showCustomKW))
        {
            Navigation.NavigateTo($"/rifornimento?column={columnSelected}&kw={(showCustomKW ? selectedCustomKW.ToString() : selectedCustomKW.ToString())}");
        }
        else
        {
            // Mostra un avviso o gestisci il caso in cui non siano selezionati KW o colonnine
            Console.WriteLine("Seleziona KW e colonnina prima di procedere.");
        }
    }
}
